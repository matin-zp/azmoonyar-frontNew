<div class="course-details-container" *ngIf="!loading && course; else loadingTpl">
  
  <!-- Ù‡Ø¯Ø± Ø¯Ø±Ø³ -->
  <div class="course-header-section">
  <div class="header-content">
    
    <div class="course-title">
      <h1>{{ course.courseName }}</h1>
      <div class="course-meta">
        <span class="course-code">{{ convertToPersianNumbers(course.courseCode) }}</span>
        <span class="divider">|</span>
        <span class="course-teacher">Ø§Ø³ØªØ§Ø¯: {{ course.teacher.firstName }} {{ course.teacher.lastName }}</span>
      </div>
      <span class="course-teacher"> {{ course.teacher.email }} </span>
    </div>
    <button class="back-btn" (click)="goBack()">â† Ø¨Ø§Ø²Ú¯Ø´Øª</button>
  </div>
  
  <div class="course-schedule">
    <div class="schedule-item">
      <span class="schedule-icon">ğŸ“…</span>
      <span class="schedule-text">{{ course.dayOfWeek }}</span>
    </div>
    <div class="schedule-item">
      <span class="schedule-icon">ğŸ•’</span>
      <span class="schedule-text">{{ convertToPersianNumbers(course.timeC) }}</span>
    </div>
    <div class="schedule-item">
      <span class="schedule-icon">ğŸ“</span>
      <span class="schedule-text">{{ course.roomC }}</span>
    </div>
  </div>
</div>


  <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon">ğŸ‘¥</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.totalStudents.toString()) }}</div>
      <div class="stat-label">Ø¯Ø§Ù†Ø´Ø¬Ùˆ</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon">ğŸ“</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.totalExams.toString()) }}</div>
      <div class="stat-label">Ø§Ù…ØªØ­Ø§Ù† Ú©Ù„</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon">ğŸ¯</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.todayExams.toString()) }}</div>
      <div class="stat-label">Ø§Ù…ØªØ­Ø§Ù† Ø§Ù…Ø±ÙˆØ²</div>
    </div>
  </div>
  
  <div class="stat-card">
    <div class="stat-icon">ğŸ“…</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.upcomingExams.toString()) }}</div>
      <div class="stat-label">Ø¢ÛŒÙ†Ø¯Ù‡</div>
    </div>
  </div>

  <!-- Ú©Ø§Ø±Øª Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§ -->
  <div class="stat-card" *ngIf="stats.totalSurveys > 0">
    <div class="stat-icon">ğŸ“Š</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.totalSurveys.toString()) }}</div>
      <div class="stat-label">Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ</div>
    </div>
  </div>
  
  <!-- <div class="stat-card" *ngIf="stats.activeSurveys > 0">
    <div class="stat-icon">âœ…</div>
    <div class="stat-info">
      <div class="stat-number">{{ convertToPersianNumbers(stats.activeSurveys.toString()) }}</div>
      <div class="stat-label">Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ ÙØ¹Ø§Ù„</div>
    </div>
  </div> -->
</div>


  <!-- Ø¨Ø®Ø´ Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ -->
<div class="section-card">
  <div class="section-header">
    <div class="section-title-row">
      <h2>ğŸ“… Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</h2>
      <button 
        class="reserve-exam-btn small"
        (click)="navigateToExamReservation()"
      >
        ğŸ—“ï¸ Ø±Ø²Ø±Ùˆ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÛŒØ¯
      </button>
    </div>
    <span class="section-badge">{{ convertToPersianNumbers(upcomingExams.length.toString()) }} Ø§Ù…ØªØ­Ø§Ù†</span>
  </div>
  <!-- (click)="goToExam(exam.id)" -->
  <div *ngIf="upcomingExams.length > 0; else noUpcomingExams" class="exams-list">
    <div 
      *ngFor="let exam of upcomingExams" 
      class="exam-card"
      [ngClass]="getExamStatusClass(exam.startDate)"
      
    >
      <div class="exam-icon">ğŸ“</div>
      
      <div class="exam-info">
        <h3 class="exam-name">{{ exam.name }}</h3>
        <div class="exam-details">
          <span class="exam-room">ğŸ“ {{ exam.room.name }}</span>
          <span class="exam-time">ğŸ•’ {{ exam.timeRange }}</span>
        </div>
      </div>
      
      <div class="exam-date">
        <div class="exam-day">{{ exam.dayOfWeek }}</div>
        <div class="exam-date-number">{{ exam.persianDate }}</div>
        <div class="exam-status" [ngClass]="getExamStatusClass(exam.startDate)">
          {{ getExamStatusText(exam.startDate) }}
        </div>
      </div>
    </div>
  </div>
  
  <ng-template #noUpcomingExams>
    <div class="no-content-message">
      <p>ğŸ’¡ Ù‡Ù†ÙˆØ² Ø§Ù…ØªØ­Ø§Ù†ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
      <button 
        class="reserve-exam-btn"
        (click)="navigateToExamReservation()"
      >
        ğŸ—“ï¸ Ø±Ø²Ø±Ùˆ Ø§ÙˆÙ„ÛŒÙ† Ø§Ù…ØªØ­Ø§Ù†
      </button>
    </div>
  </ng-template>
</div>
<!-- Ø¨Ø®Ø´ Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§ (Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÙˆÙ„ÛŒ) -->
<!-- Ø¨Ø®Ø´ Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§ (Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÙˆÙ„ÛŒ) -->
<div class="section-card table-style" *ngIf="course?.surveys && course.surveys.length > 0">
  <div class="section-header">
    <h2>ğŸ“Š Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§</h2>
    <span class="section-badge">{{ convertToPersianNumbers(course.surveys.length.toString()) }} Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ</span>
  </div>
  
  <table class="surveys-table-clean">
    <thead>
      <tr>
        <th>Ø¹Ù†ÙˆØ§Ù† Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ</th>
        <th>ÙˆØ¶Ø¹ÛŒØª</th>
        <th>Ø¢Ù…Ø§Ø±</th>
        <th>Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</th>
        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
      </tr>
    </thead>
    
    <tbody>
      <tr *ngFor="let survey of course.surveys" class="survey-row-clean">
        <!-- Ù†Ø´Ø§Ù†Ú¯Ø± Ø±Ø£ÛŒ Ú©Ø§Ø±Ø¨Ø± -->
        <!-- <div class="user-vote-indicator" *ngIf="hasUserVoted(survey.id)">
          <span>âœ“</span>
          Ø±Ø£ÛŒ Ø´Ù…Ø§
        </div> -->
        
        <td>
          <div class="survey-card-clean">
            <div class="survey-icon-clean">ğŸ“Š</div>
            <div class="survey-info-clean">
              <div class="survey-title-clean">{{ survey.title }}</div>
              <div class="survey-subtitle-clean">Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø±Ø³</div>
            </div>
          </div>
        </td>
        
        <td>
          <div class="status-container-clean">
            <div class="status-badge-clean">
              <span class="status-icon-clean">
                {{ isSurveyActive(survey) ? 'âœ…' : 'â¸ï¸' }}
              </span>
              <span class="status-text-clean">
                {{ isSurveyActive(survey) ? 'ÙØ¹Ø§Ù„' : 'Ø¨Ø¯ÙˆÙ† Ø±Ø£ÛŒ' }}
              </span>
            </div>
          </div>
        </td>
        
        <td>
          <div class="stats-card-clean">
            <div class="stats-badge-clean">
              <span class="stats-icon-clean">ğŸ‘¥</span>
              <span class="stats-value-clean">
                {{ convertToPersianNumbers(survey.totalVotes.toString()) }} Ø±Ø£ÛŒ
              </span>
            </div>
          </div>
        </td>
        
        <td>
          <div class="options-card-clean">
            <div class="options-list-clean">
              <div 
                *ngFor="let option of survey.options; let i = index" 
                class="option-item-clean"
                [class.selected]="isOptionSelected(survey.id, i)"
                [class.disabled]="!isUserLoggedIn || userRole !== 'student' || hasUserVoted(survey.id)"
                (click)="voteForOption(survey.id, i)"
              >
                <span class="option-number-clean">
                  {{ convertToPersianNumbers((i + 1).toString()) }}
                </span>
                <span class="option-text-clean">{{ option }}</span>
                <span 
                  class="option-percentage-clean" 
                  *ngIf="isSurveyActive(survey)"
                >
                  {{ convertToPersianNumbers(getSurveyOptionPercentage(survey, option).toFixed(0)) }}%
                </span>
                
                <div 
                  class="user-vote-check" 
                  *ngIf="isOptionSelected(survey.id, i)"
                >
                  âœ“ Ø±Ø£ÛŒ Ø´Ù…Ø§
                </div>
              </div>
            </div>
          </div>
        </td>
        
        <td>
          <div class="actions-card-clean">
            <!-- Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ù†Ú©Ø±Ø¯Ù‡ -->
            <div *ngIf="!isUserLoggedIn">
              <button class="login-btn-clean" (click)="goToLogin()">
                ğŸ”’ ÙˆØ±ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø±Ø£ÛŒ
              </button>
            </div>
            
            <!-- Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø§Ø³ØªØ§Ø¯ Ø§Ø³Øª -->
            <div *ngIf="isUserLoggedIn && userRole !== 'student'">
              <span style="font-size: 12px; color: #6b7280;">ÙÙ‚Ø· Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†</span>
            </div>
            
            <!-- Ø§Ú¯Ø± Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ù‡Ø³Øª Ùˆ Ø±Ø£ÛŒ Ø¯Ø§Ø¯Ù‡ -->
            <div *ngIf="isUserLoggedIn && userRole === 'student' && hasUserVoted(survey.id)">
              <button class="cancel-vote-btn-clean" (click)="cancelVote(survey.id)">
                âœ• Ù„ØºÙˆ Ø±Ø£ÛŒ
              </button>
            </div>
            
            <!-- Ø§Ú¯Ø± Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ù‡Ø³Øª Ùˆ Ø±Ø£ÛŒ Ù†Ø¯Ø§Ø¯Ù‡ -->
            <div *ngIf="isUserLoggedIn && userRole === 'student' && !hasUserVoted(survey.id)">
              <span style="font-size: 12px; color: #6b7280;">Ø±ÙˆÛŒ Ú¯Ø²ÛŒÙ†Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</span>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  
  <!-- Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ -->
  <div *ngIf="surveyError" class="survey-error-clean">
    {{ surveyError }}
  </div>
</div>


  <!-- Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† (Ù…Ø±ØªØ¨ Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ) -->
  <div class="section-card">
    <div class="section-header">
      <h2>ğŸ‘¥ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† </h2>
      <span class="section-badge">{{ convertToPersianNumbers(stats.totalStudents.toString()) }} Ù†ÙØ±</span>
    </div>
    
    <div class="students-table">
      <table>
        <thead>
          <tr>
            <th>Ø±Ø¯ÛŒÙ</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ</th>
            <th>Ù†Ø§Ù…</th>
            <th>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of sortedStudents; let i = index">
            <td class="row-number">
              {{ (i + 1).toString() }}
            </td>
            <td class="student-number">
              {{ student.studentNumber }}
            </td>
            <td class="student-name">
              {{ student.firstName }}
            </td>
            <td class="student-name">
              {{ student.lastName }}
            </td>
            <td>
              <span class="status-badge status-active">ÙØ¹Ø§Ù„</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Ù‡Ù…Ù‡ Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§ -->
  <div class="section-card">
    <div class="section-header">
      <h2>ğŸ“‹ Ù‡Ù…Ù‡ Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§</h2>
      <span class="section-badge">{{ convertToPersianNumbers(course.exams.length.toString()) }} Ù…ÙˆØ±Ø¯</span>
    </div>
    
    <div class="all-exams-table">
      <table>
        <thead>
          <tr>
            <th>Ù†Ø§Ù… Ø§Ù…ØªØ­Ø§Ù†</th>
            <th>ØªØ§Ø±ÛŒØ®</th>
            <th>Ø²Ù…Ø§Ù†</th>
            <th>Ø³Ø§Ù„Ù†</th>
            <th>Ø¸Ø±ÙÛŒØª</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let exam of course.exams">
            <td class="exam-name-cell">
              <div class="exam-name-row">
                <span class="exam-icon-small">ğŸ“</span>
                {{ exam.name }}
              </div>
            </td>
            <td>{{ formatToPersianDatePublic(exam.startDate) }}</td>
            <td>{{ formatTimePublic(exam.startDate) }} - {{ formatTimePublic(exam.endDate) }}</td>
            <td>
              <span class="room-badge">ğŸ“ {{ exam.room.name }}</span>
            </td>
            <td>
              <span class="capacity-badge">{{ convertToPersianNumbers(exam.room.capacity.toString()) }} Ù†ÙØ±</span>
            </td>
            <td>
              <span 
                class="status-badge"
                [ngClass]="getExamStatusClass(exam.startDate)"
              >
                {{ getExamStatusText(exam.startDate) }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ -->
<div *ngIf="!loading && errorMessage" class="error-container">
  <div class="error-content">
    <div class="error-icon">âš ï¸</div>
    <h3>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</h3>
    <p>{{ errorMessage }}</p>
    <button class="back-btn" (click)="goBack()">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
  </div>
</div>

<!-- Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
<ng-template #loadingTpl>
  <div class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø³...</p>
    </div>
  </div>
</ng-template>