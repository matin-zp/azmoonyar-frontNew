<div class="dashboard-container" *ngIf="!loading && student; else loadingTpl">
  
  <!-- Ù‡Ø¯Ø± Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± -->
  <div class="dashboard-header">
    <div class="profile-info">
      <div class="avatar-circle">
        {{ getStudentAvatar() }}
      </div>
      <div class="user-details">
        <h3>{{ student.firstName }} {{ student.lastName }}</h3>
        <p>{{ student.studentNumber }}</p>
        <p class="user-email" *ngIf="student.email">{{ student.email }}</p>
      </div>
    </div>
    
    <div class="welcome-section">
      <h1>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¯Ø§Ù†Ø´Ø¬Ùˆ</h1>
      <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</p>
    </div>
  </div>

  <!-- ğŸ”µ Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ² + ØªÙ‚ÙˆÛŒÙ… -->
  <div class="row-1">
    <!-- Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ² -->
    <div class="today-overview-card">
      <div class="card-header">
        <div class="icon-bar"></div>
        <h2>Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²</h2>
      </div>
      
      <ul class="overview-list">
        <li class="overview-item" *ngFor="let item of todayOverview">
          <div class="item-number">{{ item.id }}</div>
          <span>{{ item.title }}</span>
        </li>
      </ul>
    </div>

    <!-- ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ -->
    <div class="calendar-card">
      <div class="calendar-header">
        <div class="calendar-nav">
          <button class="cal-nav-btn" (click)="prevYear()">Â« Ø³Ø§Ù„ Ù‚Ø¨Ù„</button>
          <button class="cal-nav-btn" (click)="prevMonth()">â€¹ Ù…Ø§Ù‡ Ù‚Ø¨Ù„</button>
        </div>
        
        <div class="calendar-title">
          <h3 class="month-name">{{ monthName }}</h3>
          <div class="year-text">{{ currentYear }}</div>
        </div>
        
        <div class="calendar-nav">
          <button class="cal-nav-btn" (click)="nextMonth()">Ù…Ø§Ù‡ Ø¨Ø¹Ø¯ â€º</button>
          <button class="cal-nav-btn" (click)="nextYear()">Ø³Ø§Ù„ Ø¨Ø¹Ø¯ Â»</button>
        </div>
      </div>

      <div class="week-days">
        <div *ngFor="let day of daysOfWeek">{{ day }}</div>
      </div>

      <div class="calendar-grid">
        <div
          *ngFor="let day of calendarGrid"
          class="cal-day"
          [ngClass]="{ 'cal-today': isToday(day), 'cal-empty': day === null }"
        >
          {{ day ?? '' }}
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ”µ Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ±Ùˆ -->
  <div class="exams-card">
    <div class="exams-header">
      <div class="exams-title">
        <div class="icon-bar"></div>
        <h2>Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ±Ùˆ</h2>
      </div>
      <div class="exams-count">
        {{ upcomingExams.length }} Ø§Ù…ØªØ­Ø§Ù†
      </div>
    </div>

    <table class="exams-table-clean">
      <thead>
        <tr>
          <th>Ù†Ø§Ù… Ø§Ù…ØªØ­Ø§Ù†</th>
          <th>Ø¯Ø±Ø³</th>
          <th>ØªØ§Ø±ÛŒØ®</th>
          <th>Ø²Ù…Ø§Ù†</th>
          <th>Ø³Ø§Ù„Ù†</th>
          <th>ÙˆØ¶Ø¹ÛŒØª</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let item of visibleExams; let i = index"
          class="exam-row-clean"
          [ngClass]="[
            getWeekCssClass(item.weekColor),
            isExamPast(item) ? 'exam-past-clean' : ''
          ]"
        >
          <td>
            <div class="exam-card-clean">
              <div class="exam-icon-clean">ğŸ“</div>
              <div class="exam-info-clean">
                <div class="exam-title-clean">{{ item.name }}</div>
                <div class="exam-subtitle-clean">{{ item.teacherName }}</div>
              </div>
            </div>
          </td>
          <td>
            <div class="exam-info-clean">
              <div class="exam-title-clean" style="font-size: 14px;">{{ item.courseName }}</div>
              <div class="exam-subtitle-clean">{{ item.courseCode }}</div>
            </div>
          </td>
          <td>
            <div class="date-card-clean">
              <div class="date-day-clean">{{ getPersianDay(item.date) }}</div>
              <div class="date-number-clean">{{ item.date }}</div>
            </div>
          </td>
          <td>
            <div class="time-container-clean">
              <div class="time-slot-clean">
                <span class="time-icon-clean">â°</span>
                <span class="time-value-clean">{{ item.startTime }} - {{ item.endTime }}</span>
              </div>
            </div>
          </td>
          <td>
            <div class="room-card-clean">
              <span class="room-icon-clean">ğŸ“</span>
              <span class="room-name-clean">{{ item.roomName }}</span>
            </div>
          </td>
          <td>
            <div class="status-container-clean">
              <div 
                class="status-indicator-clean"
                [ngClass]="{
                  'status-indicator-active-clean': item.status === 'active',
                  'status-indicator-pending-clean': item.status === 'pending',
                  'status-indicator-completed-clean': item.status === 'completed'
                }"
              ></div>
              <span 
                class="status-text-clean"
                [ngClass]="{
                  'status-text-active-clean': item.status === 'active',
                  'status-text-pending-clean': item.status === 'pending',
                  'status-text-completed-clean': item.status === 'completed'
                }"
              >
                {{ 
                  item.status === 'active' ? 'ÙØ¹Ø§Ù„' :
                  item.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±' :
                  item.status === 'completed' ? 'Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡' : 'Ù†Ø§Ù…Ø´Ø®Øµ'
                }}
              </span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="exams-footer" *ngIf="upcomingExams.length > 0">
      <button class="show-more-btn" (click)="toggleShowMore()">
        {{ showAllExams ? 'Ù†Ù…Ø§ÛŒØ´ Ú©Ù…ØªØ±' : 'Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ø§Ù…ØªØ­Ø§Ù†â€ŒÙ‡Ø§' }}
      </button>
      <div class="exams-count">
        Ù†Ù…Ø§ÛŒØ´ {{ visibleExams.length }} Ø§Ø² {{ upcomingExams.length }} Ø§Ù…ØªØ­Ø§Ù†
      </div>
    </div>

    <div class="no-exams" *ngIf="upcomingExams.length === 0">
      <div class="no-exams-icon">ğŸ“…</div>
      <p>Ø§Ù…ØªØ­Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>
      <button class="create-exam-btn" disabled>Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÛŒØ¯</button>
    </div>
  </div>

  <!-- ğŸ”µ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ù† -->
  <div class="courses-card">
    <div class="courses-header">
      <div class="courses-title">
        <div class="icon-bar"></div>
        <h2>Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
      </div>
      <button class="add-course-btn" disabled>+ Ø«Ø¨Øª Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯</button>
    </div>

    <div class="courses-grid">
      <div
        *ngFor="let course of myCourses"
        class="course-item"
        (click)="navigateToCourse(course.id)"
      >
        <div class="course-header">
          <div class="course-icon">ğŸ“š</div>
          <span class="course-code">{{ course.courseCode }}</span>
        </div>
        
        <h3 class="course-name">{{ course.courseName }}</h3>
        
        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø³ØªØ§Ø¯ Ùˆ Ø²Ù…Ø§Ù† Ú©Ù„Ø§Ø³ -->
        <div class="course-info" style="display: flex; flex-direction: column; gap: 8px; margin: 12px 0;">
          <div style="display: flex; align-items: center; gap: 8px; color: #4b5563; font-size: 14px;">
            <span>ğŸ‘¨â€ğŸ«</span>
            <span>{{ getTeacherName(course) }}</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px; color: #4b5563; font-size: 14px;">
            <span>ğŸ“…</span>
            <span>{{ course.dayOfWeek }} - {{ course.timeC }}</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px; color: #4b5563; font-size: 14px;">
            <span>ğŸ«</span>
            <span>{{ course.roomC }}</span>
          </div>
        </div>
        
        <div class="course-stats">
          <div class="stat-item">
            <span>ğŸ‘¥</span>
            <span>{{ course.studentCount }} Ø¯Ø§Ù†Ø´Ø¬Ùˆ</span>
          </div>
          <div class="stat-item">
            <span>ğŸ“…</span>
            <span>{{ course.examCount }} Ø§Ù…ØªØ­Ø§Ù†</span>
          </div>
          <div class="stat-item">
            <span>ğŸ“–</span>
            <span>{{ course.unitCount }} ÙˆØ§Ø­Ø¯</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
<ng-template #loadingTpl>
  <div class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ...</p>
    </div>
  </div>
</ng-template>

<!-- Ø¯ÛŒØ§Ù„ÙˆÚ¯ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
<div class="edit-dialog-overlay" *ngIf="editDialogVisible">
  <div class="edit-dialog">
    <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ø´Ø¬Ùˆ</h3>
    <div class="form-group">
      <label>Ù†Ø§Ù…:</label>
      <input type="text" [(ngModel)]="editModel.firstName" />
    </div>
    <div class="form-group">
      <label>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
      <input type="text" [(ngModel)]="editModel.lastName" />
    </div>
    <div class="form-group">
      <label>Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ:</label>
      <input type="text" [(ngModel)]="editModel.studentNumber" disabled />
    </div>
    <div class="form-group">
      <label>Ø§ÛŒÙ…ÛŒÙ„:</label>
      <input type="email" [(ngModel)]="editModel.email" />
    </div>
    <div class="form-group">
      <label>ØªÙ„ÙÙ†:</label>
      <input type="tel" [(ngModel)]="editModel.phone" />
    </div>
    <div class="dialog-actions">
      <button class="btn-cancel" (click)="cancelEdit()">Ù„ØºÙˆ</button>
      <button class="btn-save" (click)="saveChanges()">Ø°Ø®ÛŒØ±Ù‡</button>
    </div>
  </div>
</div>